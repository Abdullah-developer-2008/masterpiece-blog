<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Create New Post | The Masterpiece</title>
    <link rel="stylesheet" href="style.css">
</head>

<body class="auth-page">
    <div class="auth-container">
        <h1 class="serif-title">New <em>Draft</em></h1>
        <form id="postForm" class="auth-form">
            <input type="text" id="postTitle" placeholder="Article Title" required>
            <select id="postCategory">
                <option value="Architecture">Architecture</option>
                <option value="Lifestyle">Lifestyle</option>
                <option value="Technology">Technology</option>
                <option value="Design">Design</option>
            </select>
            <textarea id="postContent" placeholder="Start writing your masterpiece..." rows="10" required></textarea>
            <button type="submit" class="auth-btn">Publish Story</button>
            <a href="index.html" class="back-link">‚Üê Cancel and Go Back</a>
        </form>
    </div>

    <script>
        document.getElementById('postForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('token');
            const authorName = localStorage.getItem('username');

            if (!token) {
                alert("Please login first");
                window.location.href = 'login.html';
                return;
            }

            const postData = {
                title: document.getElementById('postTitle').value,
                category: document.getElementById('postCategory').value,
                content: document.getElementById('postContent').value,
                authorName: authorName
            };

            // Inside your postForm listener...
            // Change your fetch logic to this:

            const response = await fetch('http://127.0.0.1:5000/api/posts/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': token
                },
                body: JSON.stringify(postData)
            });

            const result = await response.json();

            if (response.ok) {
                alert("Post Created!");
                window.location.href = 'index.html';
            } else {
                if (result.msg === "Token is not valid" || result.msg === "No token, authorization denied") {
                    alert("Your session has expired. Please log in again.");
                    localStorage.clear(); // Wipe the dead token
                    window.location.href = 'login.html'; // Send them to login
                } else {
                    alert("Error: " + result.msg);
                }
            }
        });
 
    </script>
</body>

</html>